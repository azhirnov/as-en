# Copyright (c) Zhirnov Andrey. For more information see 'LICENSE'

file( GLOB_RECURSE CPP_SOURCES "*.*" )

if (DEFINED ANDROID)
    add_library( "TestLauncher" SHARED ${CPP_SOURCES} )

    if (TARGET "Tests.Base")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Base" )
    endif()
    if (TARGET "Tests.Scripting")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Scripting" )
    endif()
    if (TARGET "Tests.Threading")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Threading" )
    endif()
    if (TARGET "Tests.Networking")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Networking" )
    endif()
    if (TARGET "Tests.Serializing")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Serializing" )
    endif()
    if (TARGET "Tests.Platform")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Platform" )
    endif()
    if (TARGET "Tests.Graphics")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.Graphics" )
    endif()
    if (TARGET "Tests.GraphicsHL")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.GraphicsHL" )
    endif()
    if (TARGET "Tests.ECS-st")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.ECS-st" )
    endif()
    if (TARGET "Tests.AtlasTools")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.AtlasTools" )
    endif()
    if (TARGET "Tests.GeometryTools")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.GeometryTools" )
    endif()
    if (TARGET "Tests.VFS")
        target_link_libraries( "TestLauncher" PUBLIC "Tests.VFS" )
    endif()

    if (TARGET "Perf.Base")
        target_link_libraries( "TestLauncher" PUBLIC "Perf.Base" )
    endif()
    if (TARGET "Perf.Threading")
        target_link_libraries( "TestLauncher" PUBLIC "Perf.Threading" )
    endif()

else()
    set( ANDROID_SRC_PATH "${MAIN_SOURCE_DIR}/android/test/src/main" )
    if (NOT EXISTS "${ANDROID_SRC_PATH}")
        message( FATAL_ERROR "Android source is not exists in ${ANDROID_SRC_PATH}" )
    endif()
    file( GLOB_RECURSE ANDROID_SOURCES "${ANDROID_SRC_PATH}/*.*" )
    list( APPEND ANDROID_SOURCES "${ANDROID_SRC_PATH}/../../build.gradle" )

    add_executable( "TestLauncher" ${CPP_SOURCES} ${ANDROID_SOURCES} )

    source_group( "Apk" FILES ${ANDROID_SOURCES} )
    set_source_files_properties( ${ANDROID_SOURCES} PROPERTIES HEADER_FILE_ONLY TRUE )
endif()

source_group( TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${CPP_SOURCES} )
target_link_libraries( "TestLauncher" PUBLIC "Platform" )
set_property( TARGET "TestLauncher" PROPERTY FOLDER "Engine/Tests" )
