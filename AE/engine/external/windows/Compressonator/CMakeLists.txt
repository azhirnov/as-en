# Copyright (c) Zhirnov Andrey. For more information see 'LICENSE'
#
# download Compressonator (multiple licenses)

set( COMPRESSONATOR_PATH "${AE_DST_PATH}/Compressonator" )

if (NOT EXISTS "${COMPRESSONATOR_PATH}/lib")
	message( FATAL_ERROR "'${COMPRESSONATOR_PATH}/lib' path is not found" )
endif()
#------------------------------------------------

add_library( "Compressonator-lib" INTERFACE )
target_include_directories( "Compressonator-lib" INTERFACE "${COMPRESSONATOR_PATH}/include" )
target_compile_definitions( "Compressonator-lib" INTERFACE "AE_ENABLE_COMPRESSONATOR" "AE_LICENSE_BSD3" "AE_LICENSE_MIT" )
install( DIRECTORY "${COMPRESSONATOR_PATH}/license" DESTINATION "3party_license/Compressonator-license" )

set_property( TARGET "Compressonator-lib" PROPERTY INTERFACE_LINK_LIBRARIES
	$<$<CONFIG:Release>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Release>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_SSE${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Release>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Release>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX512${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Release>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Compressonator${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	
	$<$<CONFIG:Profile>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Profile>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_SSE${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Profile>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Profile>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX512${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Profile>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Compressonator${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	
	$<$<CONFIG:Develop>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Develop>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_SSE${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Develop>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Develop>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX512${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Develop>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Compressonator${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	
	$<$<CONFIG:Debug>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Cored${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Debug>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_SSEd${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Debug>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVXd${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Debug>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Core_AVX512d${CMAKE_STATIC_LIBRARY_SUFFIX}" >
	$<$<CONFIG:Debug>: "${COMPRESSONATOR_PATH}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}CMP_Compressonatord${CMAKE_STATIC_LIBRARY_SUFFIX}" >
)
#------------------------------------------------

if (${AE_ENABLE_EXTERNAL_TESTS})
	add_executable( "Tests.Compressonator" "tests/main.cpp" )
	#add_test( NAME "Tests.Compressonator" COMMAND "Tests.Compressonator" )
	set_property( TARGET "Tests.Compressonator" PROPERTY FOLDER "Engine/External/Tests" )
	target_link_libraries( "Tests.Compressonator" PUBLIC "Compressonator-lib" )
endif ()
